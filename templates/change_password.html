{% extends "base.html" %}

{% block content %}
<div style="max-width: 600px; margin: 0 auto;">
    <h2>Change Password</h2>
    
    <div class="card" style="background-color: #e8f4f8; border-left: 4px solid #3498db;">
        <p><strong>ℹ️ Password Requirements:</strong></p>
        <ul style="margin: 0.5rem 0 0 1.5rem;">
            <li>Minimum 8 characters</li>
            <li>At least one uppercase letter</li>
            <li>At least one lowercase letter</li>
            <li>At least one number</li>
        </ul>
    </div>
    
    <form method="POST" class="card">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="form-group">
            <label for="current_password">Current Password *</label>
            <input type="password" id="current_password" name="current_password" required class="form-control" autocomplete="current-password">
        </div>
        
        <div class="form-group">
            <label for="new_password">New Password *</label>
            <input type="password" id="new_password" name="new_password" required class="form-control" autocomplete="new-password" minlength="8">
        </div>
        
        <div class="form-group">
            <label for="confirm_password">Confirm New Password *</label>
            <input type="password" id="confirm_password" name="confirm_password" required class="form-control" autocomplete="new-password" minlength="8">
        </div>
        
        <div id="password-strength" style="margin-bottom: 1rem;"></div>
        
        <button type="submit" class="btn btn-success">Change Password</button>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancel</a>
    </form>
</div>

<script>
const newPassword = document.getElementById('new_password');
const confirmPassword = document.getElementById('confirm_password');
const strengthDiv = document.getElementById('password-strength');

newPassword.addEventListener('input', checkPasswordStrength);
confirmPassword.addEventListener('input', checkPasswordMatch);

function checkPasswordStrength() {
    const password = newPassword.value;
    let strength = 0;
    let feedback = [];
    
    if (password.length >= 8) strength++;
    else feedback.push('At least 8 characters');
    
    if (/[a-z]/.test(password)) strength++;
    else feedback.push('One lowercase letter');
    
    if (/[A-Z]/.test(password)) strength++;
    else feedback.push('One uppercase letter');
    
    if (/[0-9]/.test(password)) strength++;
    else feedback.push('One number');
    
    if (/[^a-zA-Z0-9]/.test(password)) strength++;
    
    let color, text;
    if (strength < 2) {
        color = '#e74c3c';
        text = 'Weak';
    } else if (strength < 4) {
        color = '#f39c12';
        text = 'Fair';
    } else if (strength < 5) {
        color = '#3498db';
        text = 'Good';
    } else {
        color = '#27ae60';
        text = 'Strong';
    }
    
    strengthDiv.innerHTML = `
        <div style="display: flex; align-items: center; gap: 0.5rem;">
            <div style="flex: 1; height: 8px; background-color: #ecf0f1; border-radius: 4px; overflow: hidden;">
                <div style="width: ${strength * 20}%; height: 100%; background-color: ${color}; transition: all 0.3s;"></div>
            </div>
            <span style="color: ${color}; font-weight: bold;">${text}</span>
        </div>
        ${feedback.length > 0 ? `<small style="color: #7f8c8d;">Missing: ${feedback.join(', ')}</small>` : ''}
    `;
    
    checkPasswordMatch();
}

function checkPasswordMatch() {
    if (confirmPassword.value && newPassword.value !== confirmPassword.value) {
        confirmPassword.setCustomValidity('Passwords do not match');
        confirmPassword.style.borderColor = '#e74c3c';
    } else {
        confirmPassword.setCustomValidity('');
        confirmPassword.style.borderColor = '';
    }
}
</script>
{% endblock %}