{% extends "base.html" %}

{% block content %}
<h2>System Audit Log</h2>

<p class="help-text">This log shows all system changes for transparency and debugging.</p>

<table class="data-table">
    <thead>
        <tr>
            <th>Time</th>
            <th>User</th>
            <th>Action</th>
            <th>Table</th>
            <th>Record ID</th>
            <th>IP Address</th>
        </tr>
    </thead>
    <tbody>
        {% for log in pagination.items %}
        <tr>
            <td>{{ log.timestamp.strftime('%Y-%m-%d %I:%M:%S %p') }}</td>
            <td>{{ log.user.username if log.user else 'System' }}</td>
            <td>{{ log.action.replace('_', ' ').title() }}</td>
            <td>{{ log.table_name or '-' }}</td>
            <td>{{ log.record_id or '-' }}</td>
            <td>{{ log.ip_address or '-' }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6" style="text-align: center;">No audit logs found</td></tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination -->
{% if pagination.pages > 1 %}
<div class="pagination">
    {% if pagination.has_prev %}
        <a href="{{ url_for('audit_log', page=pagination.prev_num) }}" class="btn btn-secondary">« Previous</a>
    {% endif %}
    
    <span style="padding: 0.5rem 1rem;">
        Page {{ pagination.page }} of {{ pagination.pages }}
    </span>
    
    {% if pagination.has_next %}
        <a href="{{ url_for('audit_log', page=pagination.next_num) }}" class="btn btn-secondary">Next »</a>
    {% endif %}
</div>
{% endif %}

<style>
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 1.5rem;
}
</style>
{% endblock %}